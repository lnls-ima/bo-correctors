#!/usr/bin/env python-sirius

import matplotlib.pyplot as plt
import numpy as np


def correct_excdata(plot=True):

    # excdata from control system (average)
    excdata_csconsts = np.array([
        [-0010.00,  -3.398383e-03, -8.425965e-06,  +2.583121e-04, +1.587292e-04,  -2.695799e-02, +2.620342e-03,  -1.553539e-01, -6.523450e-02,  +8.088739e+01, -8.714218e-02,  -1.368405e+03, -2.156496e+02,  +4.887230e+05, -9.858975e+03,  +4.710394e+05, +3.641012e+05,  -1.290602e+07, -4.440818e+06,  +4.466136e+09, +1.089780e+09,  -6.812295e+11, -2.522424e+10,  -3.208019e+12, +1.282614e+12, ],
        [-0009.00,  -3.064725e-03, -8.255718e-06,  +2.688022e-04, +1.575913e-04,  -2.568082e-02, +1.370582e-03,  -1.469397e-01, -5.358015e-02,  +7.106727e+01, -3.122564e+00,  -1.259417e+03, -2.140367e+02,  +4.431507e+05, -9.023161e+03,  +4.158998e+04, +2.192610e+05,  +1.351718e+07, +2.132305e+07,  +3.250934e+09, -3.816763e+08,  -5.977394e+11, +9.509546e+07,  +1.547334e+12, +3.848201e+11, ],
        [-0007.00,  -2.391246e-03, -7.789769e-06,  +2.819800e-04, +1.412629e-04,  -2.039835e-02, +1.739255e-03,  -1.297327e-01, -9.460465e-02,  +5.655333e+01, -1.667196e+00,  -9.574974e+02, -2.039439e+02,  +3.476922e+05, -8.396397e+03,  -5.489707e+04, +1.150394e+05,  -1.188591e+06, +1.707762e+06,  +3.205790e+09, -1.028191e+08,  -4.968694e+11, -1.819255e+10,  +4.087165e+11, +2.714773e+12, ],
        [-0005.00,  -1.715044e-03, -7.116952e-06,  +2.922541e-04, +1.359813e-04,  -1.577222e-02, +2.500750e-03,  -1.052328e-01, -7.084739e-02,  +3.995335e+01, -2.116544e+00,  -6.599904e+02, -1.748853e+02,  +2.471236e+05, -5.502226e+03,  -6.661141e+04, +2.800684e+05,  -2.845967e+06, +6.271879e+06,  +2.103810e+09, -1.600677e+08,  -3.154624e+11, -5.029757e+09,  -8.633383e+11, +6.760117e+11, ],
        [-0003.00,  -1.037052e-03, -6.508364e-06,  +3.069885e-04, +1.318538e-04,  -1.098588e-02, +2.608595e-03,  -8.591148e-02, -5.122169e-02,  +2.409661e+01, -2.196078e+00,  -3.809411e+02, -6.050812e+01,  +1.509743e+05, -2.047959e+03,  -1.905855e+04, +2.754973e+05,  -3.755609e+06, +1.560496e+06,  +1.218888e+09, +2.219834e+08,  -1.946772e+11, -1.032309e+09,  -2.614056e+10, +1.187478e+12, ],
        [-0001.00,  -3.575107e-04, -5.932944e-06,  +3.202527e-04, +1.258001e-04,  -6.056233e-03, +2.690274e-03,  -6.096413e-02, -4.725764e-02,  +8.472264e+00, -2.423284e+00,  -1.018594e+02, -3.867079e+01,  +5.329087e+04, +2.932889e+02,  -2.395528e+03, +2.465142e+05,  -4.668101e+06, -2.637857e+05,  +4.951115e+08, +1.124354e+08,  -6.064703e+10, -4.165455e+09,  +2.184466e+10, +4.648660e+11, ],
        # [+0000.00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00, ],
        [+0001.00,  +3.345471e-04, -5.277621e-06,  +3.288850e-04, +1.152042e-04,  -5.688614e-04, +2.801464e-03,  -4.247607e-02, -4.453358e-02,  -7.958532e+00, -3.293963e+00,  +1.955847e+02, +3.360476e+01,  -4.579113e+04, +3.556730e+03,  +2.985840e+04, +1.928237e+05,  -7.077022e+06, -6.192791e+06,  -3.201749e+08, -3.705909e+08,  +6.693771e+10, +5.899722e+08,  +4.823429e+11, +1.287354e+12, ],
        [+0003.00,  +1.010189e-03, -4.653077e-06,  +3.466092e-04, +1.110588e-04,  +4.068506e-03, +2.727260e-03,  -2.820698e-02, -3.055517e-02,  -2.325966e+01, -3.922823e+00,  +4.718138e+02, +2.302723e+01,  -1.420640e+05, +5.784607e+03,  -8.163267e+04, +2.079146e+05,  -1.382737e+07, -4.543657e+06,  -1.102891e+09, -1.164921e+07,  +1.942993e+11, +1.803859e+10,  -6.346497e+10, +4.219310e+11, ],
        [+0005.00,  +1.689155e-03, -4.082576e-06,  +3.559777e-04, +1.006996e-04,  +9.112418e-03, +2.850879e-03,  -1.621768e-02, -2.769318e-02,  -3.858683e+01, -3.729265e+00,  +7.461537e+02, +1.265576e+02,  -2.334838e+05, +1.127552e+04,  -2.200466e+05, +2.169665e+05,  -6.125485e+05, -6.494034e+06,  -1.295088e+09, -4.574078e+08,  +3.458569e+11, -1.668506e+10,  +2.265590e+12, +6.371769e+11, ],
        [+0007.00,  +2.370536e-03, -3.422658e-06,  +3.715175e-04, +9.656928e-05,  +1.410301e-02, +2.887367e-03,  +1.218062e-02, -2.391220e-02,  -5.484139e+01, -4.023226e+00,  +1.115059e+03, +7.471901e+01,  -3.376588e+05, +1.206279e+04,  +4.942462e+03, +5.799556e+04,  -6.982168e+06, -1.262422e+07,  -2.718451e+09, -4.846099e+08,  +4.988445e+11, -3.114213e+10,  +1.164804e+12, +1.021168e+12, ],
        [+0009.00,  +3.053953e-03, -2.904661e-06,  +3.823563e-04, +8.361838e-05,  +1.921031e-02, +3.483743e-03,  +3.970082e-02, -1.104663e-02,  -7.027760e+01, -3.854574e+00,  +1.405604e+03, +2.002325e+02,  -4.311071e+05, +1.609424e+04,  -2.096238e+04, +7.058420e+04,  -9.835609e+06, +5.709837e+06,  -3.577574e+09, -3.220118e+08,  +5.967516e+11, +5.616626e+10,  +3.298498e+12, +1.304225e+12, ],
        [+0010.00,  +3.396649e-03, -2.690961e-06,  +3.883625e-04, +7.483404e-05,  +2.192704e-02, +3.064070e-03,  +6.899141e-02, -1.834344e-02,  -7.839168e+01, -6.388398e+00,  +1.472304e+03, +2.179928e+02,  -4.850424e+05, +1.429201e+04,  -3.362258e+05, +3.341882e+05,  -3.141783e+07, -1.271509e+07,  -3.712567e+09, +4.721585e+08,  +6.316630e+11, -8.270538e+09,  +8.607104e+11, -4.638441e+09, ],
    ])

    # excdata_2015
    # 2015-03-17_09-23-42_BC-008_BG_Imc=-0000A.dat
    # 2015-03-17_09-24-38_BC-008_BG_Imc=+0001A.dat
    # 2015-03-17_09-25-37_BC-008_BG_Imc=+0003A.dat
    # 2015-03-17_09-26-37_BC-008_BG_Imc=+0005A.dat
    # 2015-03-17_09-27-37_BC-008_BG_Imc=+0007A.dat
    # 2015-03-17_09-29-27_BC-008_BG_Imc=+0009A.dat
    # 2015-03-17_09-30-25_BC-008_BG_Imc=+0010A.dat
    excdata_old = np.array([
        [0000.00, +2.640941e-06, +4.904447e-06, -2.665597e-04, -9.739831e-05, +2.388248e-03, -2.027389e-03, +3.444513e-02, +1.134466e-02, -1.953951e-01, +3.068476e+00, -5.984129e+01, +9.785237e+01, +4.370824e+03, -2.523195e+03, +2.616690e+05, -3.463665e+05, -4.966697e+06, -1.276840e+06, -1.889489e+08, +2.396509e+08, +6.768747e+10, +8.497187e+08, -1.480250e+12, -2.628638e+11, ],
        [0001.00, -3.252044e-04, +4.849908e-06, -2.936324e-04, -9.873492e-05, -7.811919e-04, -1.415130e-03, +2.498545e-02, +1.437350e-02, +6.824609e+00, +2.775617e+00, -1.230052e+02, -3.537699e+01, +4.801895e+04, -1.821660e+03, +2.038633e+05, +1.371873e+04, +2.733537e+06, +9.410390e+06, +1.719314e+08, +7.879109e+07, -1.005718e+11, -1.017107e+10, -1.783071e+12, +4.841257e+11, ],
        [0003.00, -9.887063e-04, +4.147015e-06, -3.196957e-04, -1.036346e-04, -8.440657e-03, -2.761179e-03, -2.886692e-02, -1.456045e-02, +2.228520e+01, +6.632066e+00, -4.719676e+02, -2.379535e+02, +1.390722e+05, -1.452471e+04, +1.977957e+05, -2.270261e+05, +8.616631e+06, +5.439910e+06, +1.240031e+09, -1.655458e+08, -1.626031e+11, -3.244754e+10, -4.721941e+11, +1.144952e+12, ],
        [0005.00, -1.655832e-03, +3.711682e-06, -3.558960e-04, -1.208391e-04, -1.604298e-02, -2.040819e-03, -3.292864e-02, -4.233882e-02, +3.555571e+01, +5.837395e+00, -6.617607e+02, -2.546218e+02, +2.360689e+05, -2.546635e+04, -1.095531e+05, -1.143073e+04, +2.236007e+07, +1.958706e+07, +2.329806e+09, +3.611852e+08, -3.573948e+11, +5.428790e+10, -1.569962e+12, -2.360996e+12, ],
        [0007.00, -2.325420e-03, +2.916410e-06, -3.794153e-04, -1.403975e-04, -2.195970e-02, -1.902363e-03, -1.329925e-01, -1.773864e-02, +5.966076e+01, +6.902334e+00, -1.305485e+03, +3.732134e+02, +3.152502e+05, -3.030935e+04, -1.450234e+03, -4.797175e+05, -1.528298e+07, -1.336479e+07, -4.686128e+08, +1.405498e+09, -3.216866e+11, +3.173159e+10, -1.759416e+13, +1.685956e+12, ],
        [0009.00, -2.996192e-03, +2.066195e-06, -3.888954e-04, -1.341673e-04, -3.059776e-02, -1.930594e-03, -3.224669e-02, -7.963061e-02, +6.655750e+01, +1.178322e+01, -1.396963e+03, -7.901643e+02, +4.461193e+05, -3.882614e+04, +6.849088e+05, +2.335193e+05, +5.809177e+07, +2.469399e+07, +1.104703e+10, +2.343662e+09, -4.280088e+11, +2.691036e+11, +1.985325e+13, -9.321815e+11, ],
        [0010.00, -3.324152e-03, +1.895411e-06, -4.328513e-04, -1.406219e-04, -3.474430e-02, -3.490050e-03, -5.874009e-02, -6.325633e-02, +7.568667e+01, +5.552300e+00, -9.468606e+02, -3.350022e+02, +4.562487e+05, -3.861842e+04, +1.015907e+06, +1.299835e+05, +4.581564e+07, -4.491747e+07, +5.608907e+09, +5.710754e+09, -5.121637e+11, -5.705193e+10, +2.769707e+12, +4.286533e+12, ],
    ])

    # excdata_2021_positive
    # BC-008_D_BOA_000.0A_210211_125212.dat
    # BC-008_D_BOA_002.0A_210211_125240.dat
    # BC-008_D_BOA_004.0A_210211_125308.dat
    # BC-008_D_BOA_006.0A_210211_125336.dat
    # BC-008_D_BOA_008.0A_210211_125405.dat
    # BC-008_D_BOA_010.0A_210211_125434.dat
    excdata_pos = np.array([
        [+0000.00, -1.223532e-05, -8.892332e-06, -2.552104e-05, -1.759515e-04, -5.260586e-04, -5.866077e-04, -8.949032e-03, -1.583757e-02, -1.179822e+00, -2.234286e+00, +3.817847e+01, +4.031855e-01, +2.990615e+03, +9.033672e+03, +2.457051e+05, +6.260748e+05, -5.596448e+07, +3.947847e+07, +8.476901e+08, +3.969124e+09, +2.197228e+11, +2.966938e+10, -2.072468e+13, -5.932280e+11,],
        [+0002.00, -6.738570e-04, -1.222893e-05, -4.451166e-05, -1.910497e-04, -7.957383e-03, -1.010794e-03, -2.846984e-02, -3.425332e-02, +1.462946e+01, -3.116716e+00, -3.703453e+02, -2.429679e+02, +1.112025e+05, +5.605363e+03, -9.844917e+05, +1.437099e+06, +3.299866e+06, +4.302534e+07, -6.287307e+09, +7.002478e+09, -7.634727e+11, -1.932070e+11, -1.000605e+13, -2.114451e+13,],
        [+0004.00, -1.342626e-03, -1.585597e-05, -5.535897e-05, -1.928160e-04, -1.469335e-02, -1.151722e-03, -3.164412e-02, -7.007202e-02, +3.153890e+01, -1.931137e+00, -4.585011e+02, -1.284049e+02, +2.105115e+05, +4.188183e+03, +3.339472e+04, +1.628116e+06, +2.198584e+07, +2.063024e+07, +2.439512e+08, +1.443470e+10, -7.069801e+11, -4.507707e+11, +7.434764e+11, +2.221564e+13,],
        [+0006.00, -2.014009e-03, -1.951540e-05, -7.727784e-05, -2.018556e-04, -2.348612e-02, -1.324988e-03, -5.423475e-02, -9.834566e-02, +4.734448e+01, +6.006175e-02, -8.023601e+02, -1.262068e+01, +3.291784e+05, +9.371806e+03, +9.661656e+05, -1.777468e+04, +5.270645e+07, +7.562742e+07, +7.551882e+09, +1.377937e+10, -1.140567e+12, -1.912381e+11, -2.326019e+12, -6.504169e+12,],
        [+0008.00, -2.687053e-03, -2.313901e-05, -9.109325e-05, -2.209044e-04, -3.173998e-02, -1.382726e-03, -9.831989e-02, -6.380106e-02, +6.815381e+01, -8.143630e-01, -1.027237e+03, -9.439524e+01, +4.123019e+05, +2.219307e+03, -7.804902e+05, -4.553826e+05, +1.054496e+08, +6.572693e+07, -1.210691e+10, +5.177296e+09, -6.835558e+11, -4.903406e+11, -2.085602e+13, -3.567160e+13,],
        [+0010.00, -3.360603e-03, -2.677928e-05, -1.068293e-04, -2.375705e-04, -3.918041e-02, -1.651136e-03, -1.159196e-01, -7.183001e-02, +8.076217e+01, -1.853455e+00, -1.317801e+03, -2.076706e+02, +5.469554e+05, -9.292117e+03, -1.184801e+05, +5.105318e+05, +6.792433e+07, +6.648294e+07, +9.487783e+07, -1.096469e+10, -1.485317e+12, -5.879558e+11, -1.824301e+13, -5.763049e+12,],
    ])

    # excdata_2021_negative
    # BC-008_D_BOA_000.0A_210211_133159.dat
    # BC-008_D_BOA_-02.0A_210211_133227.dat
    # BC-008_D_BOA_-04.0A_210211_133256.dat
    # BC-008_D_BOA_-06.0A_210211_133324.dat
    # BC-008_D_BOA_-08.0A_210211_133351.dat
    # BC-008_D_BOA_-10.0A_210211_133419.dat
    excdata_neg = np.array([
        [-0000.00, -1.228725e-05, -8.612538e-06, -2.578836e-05, -1.678792e-04, -4.052353e-04, -9.267869e-04, -1.625308e-02, -3.412182e-02, -1.790650e+00, -1.018093e+00, -1.926794e+01, -7.057618e+01, -4.727670e+03, +1.467909e+03, +6.577939e+04, +6.817005e+05, -2.213831e+07, +3.770976e+07, +6.019652e+08, +1.316543e+09, -1.363836e+11, -2.960769e+10, -1.183002e+13, +1.749080e+12, ],
        [-0002.00, +6.489934e-04, -5.176402e-06, -9.204088e-06, -1.667722e-04, +7.229666e-03, -9.173335e-04, +9.431338e-03, -2.638608e-02, -1.419990e+01, +9.052668e-01, +2.159535e+02, -1.200848e+02, -1.030195e+05, -5.627124e+03, -1.852420e+05, +1.028840e+05, -7.155715e+07, -3.000802e+07, +1.872485e+09, -4.970625e+09, +7.837053e+11, -3.092584e+10, +2.782602e+12, -1.891857e+13, ],
        [-0004.00, +1.314201e-03, -1.451874e-06, +4.077514e-06, -1.509594e-04, +1.419770e-02, -5.618942e-04, +2.105788e-02, -4.867075e-03, -3.181333e+01, -1.343937e+00, +5.885737e+02, -6.109814e+01, -2.091718e+05, -1.148236e+03, +1.899552e+05, +4.030704e+05, -1.096714e+07, +2.140900e+07, -1.161299e+09, +7.775196e+08, +3.038943e+11, -1.109101e+10, -1.363088e+13, -6.442030e+12, ],
        [-0006.00, +1.985024e-03, +2.080850e-06, +1.898980e-05, -1.393932e-04, +2.235094e-02, +7.211098e-06, +5.816981e-02, +1.430070e-02, -5.002224e+01, -4.142177e-01, +9.234622e+02, +1.700596e+02, -3.322134e+05, -2.081961e+03, -2.687774e+05, -3.315454e+05, -5.075635e+06, +1.920118e+07, -2.891125e+09, +1.749952e+09, +9.802137e+11, +5.891247e+11, +1.631275e+13, +1.175666e+13, ],
        [-0008.00, +2.658044e-03, +5.765201e-06, +3.946621e-05, -1.283277e-04, +3.008623e-02, -1.263343e-04, +4.714156e-02, +8.253779e-02, -6.741631e+01, -9.472209e-01, +1.194524e+03, +3.701228e+01, -4.184438e+05, +2.826039e+03, +1.281834e+06, -2.339530e+05, -6.362460e+07, -4.521903e+07, +6.207991e+09, -5.626061e+09, +6.028045e+11, +5.160707e+11, +3.428702e+12, +9.848658e+12, ],
        [-0010.00, +3.331879e-03, +9.324101e-06, +4.803667e-05, -1.139347e-04, +3.806125e-02, -2.377731e-04, +8.721167e-02, +8.341072e-02, -8.267050e+01, -6.915554e-01, +1.414457e+03, +7.400807e+01, -5.417413e+05, -1.355542e+04, +1.223884e+05, +3.023973e+05, -7.189508e+07, -9.186747e+07, -1.331734e+09, -7.137961e+09, +1.308710e+12, +2.307444e+11, +3.225813e+13, -2.753240e+13, ],
    ])

    # correct inverted polarity of all measurements
    excdata_old[:, 1:] *= -1
    excdata_pos[:, 1:] *= -1
    excdata_neg[:, 1:] *= -1


    curr_2015 = excdata_old[:, 0]
    bint_2015 = excdata_old[:, 1]
    curr_2021 = excdata_pos[:, 0]
    bint_2021 = excdata_pos[:, 1]

    # plot raw data comparison
    plt.plot(curr_2015, bint_2015, 'o-', label='2015 data')
    plt.plot(curr_2021, bint_2021, 'o-', label='2021 data')
    plt.legend()
    plt.xlabel('Current [A]')
    plt.ylabel('Integrated Dipolar Field [T.m]')
    plt.title('BO BC-008 (CH) Excitation Data (positive curve) - Raw data 2021-2015 Comparison')
    plt.grid()
    plt.show()

    curr_fit = np.linspace(1.0, 10, 100)

    # 1. poly n=5 fit of 2015 data
    cfit, bfit = curr_2015[1:], bint_2015[1:]
    poly_2015 = np.polyfit(cfit, bfit, 5)
    bint_2015_fit = np.polyval(poly_2015, curr_fit)
    fit_error = 100*(np.polyval(poly_2015, cfit) - bfit) / bfit
    plt.plot(cfit, fit_error)
    plt.xlabel('Current [A]')
    plt.ylabel('Fit error [%]')
    plt.title('BC-008 2015 n=5 Polyfit Error ')
    plt.grid()
    plt.show()

    # 2. poly n=4 fit of 2021 data
    cfit, bfit = curr_2021[1:], bint_2021[1:]
    poly_2021 = np.polyfit(cfit, bfit, 4)
    bint_2021_fit = np.polyval(poly_2021, curr_fit)
    fit_error = 100*(np.polyval(poly_2021, cfit) - bfit) / bfit
    plt.plot(cfit, fit_error)
    plt.xlabel('Current [A]')
    plt.ylabel('Fit error [%]')
    plt.title('BC-008 2021 n=4 Polyfit Error ')
    plt.grid()
    plt.show()

    # 3. using polyfitted data, calculate difference
    diff_curve = 100 * (bint_2021_fit - bint_2015_fit) / bint_2015_fit
    plt.plot(curr_fit, diff_curve, 'o-', label='diff')

    cexcdata = sorted(set(abs(excdata_csconsts[:,0])))
    diff_points = np.interp(cexcdata, curr_fit, diff_curve)

    print('Current   : ', cexcdata)
    print('Difference: ', diff_points)

    plt.plot(cexcdata, diff_points, 'o', label='diff used in excdata')
    plt.xlabel('Current [A]')
    plt.ylabel('Difference [%]')
    plt.title('BC-008 2021-2015 Integrated Dipolar Field Difference [%]')
    plt.grid()
    plt.legend()
    plt.show()

    # 4. with diff x current table, correct previous excdata based on magnet averages.
    for datum in excdata_csconsts:
        curr, *mpoles = datum
        mpoles = np.array(mpoles)
        corr = 1 + np.interp(abs(curr), cexcdata, diff_points)/100
        # print(curr, corr)
        mpoles *= corr
        print('{:+08.2f}  '.format(curr), end='')
        for i in range(len(mpoles)//2):
            print('{:+.6e} {:+.6e}  '.format(mpoles[2*i+0], mpoles[2*i+1]), end='')
        print()

def plot_corrected_excdata():

    excdata_old = np.array([
        [-0010.00,  -3.398383e-03, -8.425965e-06,  +2.583121e-04, +1.587292e-04,  -2.695799e-02, +2.620342e-03,  -1.553539e-01, -6.523450e-02,  +8.088739e+01, -8.714218e-02,  -1.368405e+03, -2.156496e+02,  +4.887230e+05, -9.858975e+03,  +4.710394e+05, +3.641012e+05,  -1.290602e+07, -4.440818e+06,  +4.466136e+09, +1.089780e+09,  -6.812295e+11, -2.522424e+10,  -3.208019e+12, +1.282614e+12, ],
        [-0009.00,  -3.064725e-03, -8.255718e-06,  +2.688022e-04, +1.575913e-04,  -2.568082e-02, +1.370582e-03,  -1.469397e-01, -5.358015e-02,  +7.106727e+01, -3.122564e+00,  -1.259417e+03, -2.140367e+02,  +4.431507e+05, -9.023161e+03,  +4.158998e+04, +2.192610e+05,  +1.351718e+07, +2.132305e+07,  +3.250934e+09, -3.816763e+08,  -5.977394e+11, +9.509546e+07,  +1.547334e+12, +3.848201e+11, ],
        [-0007.00,  -2.391246e-03, -7.789769e-06,  +2.819800e-04, +1.412629e-04,  -2.039835e-02, +1.739255e-03,  -1.297327e-01, -9.460465e-02,  +5.655333e+01, -1.667196e+00,  -9.574974e+02, -2.039439e+02,  +3.476922e+05, -8.396397e+03,  -5.489707e+04, +1.150394e+05,  -1.188591e+06, +1.707762e+06,  +3.205790e+09, -1.028191e+08,  -4.968694e+11, -1.819255e+10,  +4.087165e+11, +2.714773e+12, ],
        [-0005.00,  -1.715044e-03, -7.116952e-06,  +2.922541e-04, +1.359813e-04,  -1.577222e-02, +2.500750e-03,  -1.052328e-01, -7.084739e-02,  +3.995335e+01, -2.116544e+00,  -6.599904e+02, -1.748853e+02,  +2.471236e+05, -5.502226e+03,  -6.661141e+04, +2.800684e+05,  -2.845967e+06, +6.271879e+06,  +2.103810e+09, -1.600677e+08,  -3.154624e+11, -5.029757e+09,  -8.633383e+11, +6.760117e+11, ],
        [-0003.00,  -1.037052e-03, -6.508364e-06,  +3.069885e-04, +1.318538e-04,  -1.098588e-02, +2.608595e-03,  -8.591148e-02, -5.122169e-02,  +2.409661e+01, -2.196078e+00,  -3.809411e+02, -6.050812e+01,  +1.509743e+05, -2.047959e+03,  -1.905855e+04, +2.754973e+05,  -3.755609e+06, +1.560496e+06,  +1.218888e+09, +2.219834e+08,  -1.946772e+11, -1.032309e+09,  -2.614056e+10, +1.187478e+12, ],
        [-0001.00,  -3.575107e-04, -5.932944e-06,  +3.202527e-04, +1.258001e-04,  -6.056233e-03, +2.690274e-03,  -6.096413e-02, -4.725764e-02,  +8.472264e+00, -2.423284e+00,  -1.018594e+02, -3.867079e+01,  +5.329087e+04, +2.932889e+02,  -2.395528e+03, +2.465142e+05,  -4.668101e+06, -2.637857e+05,  +4.951115e+08, +1.124354e+08,  -6.064703e+10, -4.165455e+09,  +2.184466e+10, +4.648660e+11, ],
        [+0000.00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00,  +0.000000e+00, +0.000000e+00, ],
        [+0001.00,  +3.345471e-04, -5.277621e-06,  +3.288850e-04, +1.152042e-04,  -5.688614e-04, +2.801464e-03,  -4.247607e-02, -4.453358e-02,  -7.958532e+00, -3.293963e+00,  +1.955847e+02, +3.360476e+01,  -4.579113e+04, +3.556730e+03,  +2.985840e+04, +1.928237e+05,  -7.077022e+06, -6.192791e+06,  -3.201749e+08, -3.705909e+08,  +6.693771e+10, +5.899722e+08,  +4.823429e+11, +1.287354e+12, ],
        [+0003.00,  +1.010189e-03, -4.653077e-06,  +3.466092e-04, +1.110588e-04,  +4.068506e-03, +2.727260e-03,  -2.820698e-02, -3.055517e-02,  -2.325966e+01, -3.922823e+00,  +4.718138e+02, +2.302723e+01,  -1.420640e+05, +5.784607e+03,  -8.163267e+04, +2.079146e+05,  -1.382737e+07, -4.543657e+06,  -1.102891e+09, -1.164921e+07,  +1.942993e+11, +1.803859e+10,  -6.346497e+10, +4.219310e+11, ],
        [+0005.00,  +1.689155e-03, -4.082576e-06,  +3.559777e-04, +1.006996e-04,  +9.112418e-03, +2.850879e-03,  -1.621768e-02, -2.769318e-02,  -3.858683e+01, -3.729265e+00,  +7.461537e+02, +1.265576e+02,  -2.334838e+05, +1.127552e+04,  -2.200466e+05, +2.169665e+05,  -6.125485e+05, -6.494034e+06,  -1.295088e+09, -4.574078e+08,  +3.458569e+11, -1.668506e+10,  +2.265590e+12, +6.371769e+11, ],
        [+0007.00,  +2.370536e-03, -3.422658e-06,  +3.715175e-04, +9.656928e-05,  +1.410301e-02, +2.887367e-03,  +1.218062e-02, -2.391220e-02,  -5.484139e+01, -4.023226e+00,  +1.115059e+03, +7.471901e+01,  -3.376588e+05, +1.206279e+04,  +4.942462e+03, +5.799556e+04,  -6.982168e+06, -1.262422e+07,  -2.718451e+09, -4.846099e+08,  +4.988445e+11, -3.114213e+10,  +1.164804e+12, +1.021168e+12, ],
        [+0009.00,  +3.053953e-03, -2.904661e-06,  +3.823563e-04, +8.361838e-05,  +1.921031e-02, +3.483743e-03,  +3.970082e-02, -1.104663e-02,  -7.027760e+01, -3.854574e+00,  +1.405604e+03, +2.002325e+02,  -4.311071e+05, +1.609424e+04,  -2.096238e+04, +7.058420e+04,  -9.835609e+06, +5.709837e+06,  -3.577574e+09, -3.220118e+08,  +5.967516e+11, +5.616626e+10,  +3.298498e+12, +1.304225e+12, ],
        [+0010.00,  +3.396649e-03, -2.690961e-06,  +3.883625e-04, +7.483404e-05,  +2.192704e-02, +3.064070e-03,  +6.899141e-02, -1.834344e-02,  -7.839168e+01, -6.388398e+00,  +1.472304e+03, +2.179928e+02,  -4.850424e+05, +1.429201e+04,  -3.362258e+05, +3.341882e+05,  -3.141783e+07, -1.271509e+07,  -3.712567e+09, +4.721585e+08,  +6.316630e+11, -8.270538e+09,  +8.607104e+11, -4.638441e+09, ],
    ])

    excdata_new = np.array([
        [-0010.00,  -3.435648e-03, -8.518360e-06,  +2.611446e-04, +1.604697e-04,  -2.725360e-02, +2.649075e-03,  -1.570574e-01, -6.594983e-02,  +8.177436e+01, -8.809774e-02,  -1.383410e+03, -2.180143e+02,  +4.940821e+05, -9.967084e+03,  +4.762046e+05, +3.680938e+05,  -1.304754e+07, -4.489514e+06,  +4.515109e+09, +1.101730e+09,  -6.886995e+11, -2.550084e+10,  -3.243197e+12, +1.296679e+12, ],  
        [-0009.00,  -3.093010e-03, -8.331913e-06,  +2.712831e-04, +1.590458e-04,  -2.591784e-02, +1.383232e-03,  -1.482959e-01, -5.407466e-02,  +7.172317e+01, -3.151383e+00,  -1.271041e+03, -2.160121e+02,  +4.472407e+05, -9.106439e+03,  +4.197383e+04, +2.212846e+05,  +1.364193e+07, +2.151985e+07,  +3.280938e+09, -3.851989e+08,  -6.032561e+11, +9.597313e+07,  +1.561615e+12, +3.883717e+11, ],  
        [-0007.00,  -2.416924e-03, -7.873417e-06,  +2.850080e-04, +1.427798e-04,  -2.061739e-02, +1.757931e-03,  -1.311258e-01, -9.562053e-02,  +5.716061e+01, -1.685099e+00,  -9.677792e+02, -2.061339e+02,  +3.514258e+05, -8.486559e+03,  -5.548657e+04, +1.162747e+05,  -1.201354e+06, +1.726100e+06,  +3.240214e+09, -1.039232e+08,  -5.022049e+11, -1.838791e+10,  +4.131054e+11, +2.743925e+12, ],  
        [-0005.00,  -1.738052e-03, -7.212428e-06,  +2.961748e-04, +1.378055e-04,  -1.598381e-02, +2.534298e-03,  -1.066445e-01, -7.179783e-02,  +4.048934e+01, -2.144938e+00,  -6.688444e+02, -1.772314e+02,  +2.504389e+05, -5.576040e+03,  -6.750503e+04, +2.838256e+05,  -2.884147e+06, +6.356018e+06,  +2.132033e+09, -1.622151e+08,  -3.196944e+11, -5.097233e+09,  -8.749203e+11, +6.850806e+11, ],  
        [-0003.00,  -1.057146e-03, -6.634467e-06,  +3.129366e-04, +1.344085e-04,  -1.119874e-02, +2.659138e-03,  -8.757607e-02, -5.221414e-02,  +2.456350e+01, -2.238628e+00,  -3.883221e+02, -6.168050e+01,  +1.538995e+05, -2.087639e+03,  -1.942782e+04, +2.808352e+05,  -3.828376e+06, +1.590732e+06,  +1.242505e+09, +2.262845e+08,  -1.984492e+11, -1.052311e+09,  -2.664705e+10, +1.210486e+12, ],  
        [-0001.00,  -3.745405e-04, -6.215556e-06,  +3.355078e-04, +1.317925e-04,  -6.344718e-03, +2.818424e-03,  -6.386812e-02, -4.950873e-02,  +8.875836e+00, -2.538716e+00,  -1.067114e+02, -4.051285e+01,  +5.582935e+04, +3.072596e+02,  -2.509638e+03, +2.582568e+05,  -4.890463e+06, -2.763510e+05,  +5.186959e+08, +1.177912e+08,  -6.353592e+10, -4.363874e+09,  +2.288522e+10, +4.870096e+11, ],  
        [+0001.00,  +3.504831e-04, -5.529017e-06,  +3.445513e-04, +1.206919e-04,  -5.959588e-04, +2.934910e-03,  -4.449939e-02, -4.665491e-02,  -8.337632e+00, -3.450869e+00,  +2.049013e+02, +3.520550e+01,  -4.797236e+04, +3.726153e+03,  +3.128069e+04, +2.020087e+05,  -7.414132e+06, -6.487781e+06,  -3.354263e+08, -3.882438e+08,  +7.012625e+10, +6.180752e+08,  +5.053190e+11, +1.348676e+12, ],  
        [+0003.00,  +1.029762e-03, -4.743233e-06,  +3.533250e-04, +1.132106e-04,  +4.147336e-03, +2.780102e-03,  -2.875351e-02, -3.114719e-02,  -2.371033e+01, -3.998830e+00,  +4.809555e+02, +2.347340e+01,  -1.448166e+05, +5.896687e+03,  -8.321435e+04, +2.119431e+05,  -1.409528e+07, -4.631693e+06,  -1.124260e+09, -1.187492e+07,  +1.980640e+11, +1.838810e+10,  -6.469464e+10, +4.301062e+11, ],  
        [+0005.00,  +1.711816e-03, -4.137345e-06,  +3.607533e-04, +1.020505e-04,  +9.234664e-03, +2.889125e-03,  -1.643525e-02, -2.806469e-02,  -3.910449e+01, -3.779294e+00,  +7.561636e+02, +1.282554e+02,  -2.366161e+05, +1.142679e+04,  -2.229986e+05, +2.198772e+05,  -6.207661e+05, -6.581154e+06,  -1.312462e+09, -4.635441e+08,  +3.504967e+11, -1.690890e+10,  +2.295984e+12, +6.457249e+11, ],  
        [+0007.00,  +2.395991e-03, -3.459411e-06,  +3.755069e-04, +9.760626e-05,  +1.425445e-02, +2.918372e-03,  +1.231142e-02, -2.416897e-02,  -5.543029e+01, -4.066428e+00,  +1.127033e+03, +7.552136e+01,  -3.412846e+05, +1.219232e+04,  +4.995535e+03, +5.861833e+04,  -7.057144e+06, -1.275978e+07,  -2.747642e+09, -4.898137e+08,  +5.042012e+11, -3.147654e+10,  +1.177312e+12, +1.032134e+12, ],  
        [+0009.00,  +3.082139e-03, -2.931469e-06,  +3.858852e-04, +8.439012e-05,  +1.938761e-02, +3.515896e-03,  +4.006723e-02, -1.114858e-02,  -7.092621e+01, -3.890149e+00,  +1.418577e+03, +2.020805e+02,  -4.350859e+05, +1.624278e+04,  -2.115585e+04, +7.123564e+04,  -9.926385e+06, +5.762535e+06,  -3.610593e+09, -3.249838e+08,  +6.022592e+11, +5.668464e+10,  +3.328941e+12, +1.316262e+12, ],  
        [+0010.00,  +3.433895e-03, -2.720469e-06,  +3.926211e-04, +7.565463e-05,  +2.216748e-02, +3.097669e-03,  +6.974794e-02, -1.854459e-02,  -7.925128e+01, -6.458450e+00,  +1.488449e+03, +2.203832e+02,  -4.903611e+05, +1.444873e+04,  -3.399127e+05, +3.378527e+05,  -3.176234e+07, -1.285452e+07,  -3.753277e+09, +4.773360e+08,  +6.385895e+11, -8.361229e+09,  +8.701485e+11, -4.689304e+09, ],  
    ])

    plt.plot(excdata_old[:,0], excdata_old[:,1], 'o-', label='2015 original')
    plt.plot(excdata_new[:,0], excdata_new[:,1], 'o-', label='2020 corrected')
    plt.xlabel('Current [A]')
    plt.ylabel('Integrated Dipolar Field [T.m]')
    plt.title('Old and New BO CH Excitation Curve')
    plt.legend()
    plt.grid()
    plt.show()


correct_excdata(plot=True)
plot_corrected_excdata()
